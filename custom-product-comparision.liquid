<style>
/* Keep all existing styles intact */
.product-comparison .comparison-row {
  display: flex;
  justify-content: {{ section.settings.comparison_alignment }};
}
.product-comparison {
  padding: 40px 0px;
}
.product-item {
  border: 1px solid {{ section.settings.product_border_color }};
  padding: {{ section.settings.product_padding }};
  text-align: center;
  position: relative;
  transition: transform 0.3s ease;
  flex: 1;
  min-width: {{ section.settings.product_min_width }};
  max-width: {{ section.settings.product_max_width }};
  background-color: {{ section.settings.product_bg_color }};
  border-radius: {{ section.settings.product_border_radius }};
}

.product-item:hover {
  transform: scale({{ section.settings.product_hover_scale }});
  box-shadow: 0 0 {{ section.settings.product_hover_shadow }} rgba(0, 0, 0, 0.1);
}

.product-item .current {
  border: 2px solid {{ section.settings.current_product_border_color }};
}

.view-product-button {
  display: inline-block;
  margin-top: 10px;
  background-color: {{ section.settings.button_bg_color }};
  color: {{ section.settings.button_text_color }};
  padding: {{ section.settings.button_padding }};
  text-decoration: none;
  border-radius: {{ section.settings.button_border_radius }};
  font-size: {{ section.settings.button_font_size }};
  border: {{ section.settings.button_border }};
}

.view-product-button:hover {
  background-color: {{ section.settings.button_hover_bg_color }};
  color: {{ section.settings.button_hover_text_color }};
}

.product-item .current-label {
  position: absolute;
  top: 10px;
  left: 10px;
  background-color: {{ section.settings.current_label_bg_color }};
  color: {{ section.settings.current_label_text_color }};
  padding: 5px;
  font-size: 12px;
  border-radius: {{ section.settings.current_label_border_radius }};
}

/* Modal Styling */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0, 0, 0, {{ section.settings.modal_overlay_opacity }});
}

.modal-content {
  background-color: {{ section.settings.modal_bg_color }};
  margin: 5% auto;
  padding: 20px;
  border: 1px solid #888;
  width: 90%;
  max-width: 1000px;
  border-radius: 5px;
  position: relative;
  max-height: 80vh;
  overflow-y: auto;
}

.close {
  color: {{ section.settings.close_button_color }};
  font-size: 28px;
  font-weight: bold;
  position: absolute;
  top: 10px;
  right: 15px;
  cursor: pointer;
  z-index: 1001;
}

.close:hover,
.close:focus {
  color: {{ section.settings.close_button_hover_color }};
  text-decoration: none;
  cursor: pointer;
}
.product_compare--popup {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 100%;
  border: 1px solid #8b8b8b3d;
  border-radius: 5px;
  padding: 10px;
  box-shadow: 0px 1px 4px 0 #8b8b8b33;
}
.product_compare--popup_change{
  cursor: pointer;
}
.product_compare--popup_image {
  width: 100%;
}
.product_compare--popup_title {
  font-size: 17px;
}
.product_compare--popup_price {
  font-weight: 700;
  color: #ff2600;
  margin-bottom: 0;
}
.add-to-comparison {
  background: #FF580D;
  width: 100%;
  height: 40px;
  border-radius: 5px;
  margin-top: 15px;
  color: #fff;
  font-size: 16px;
}
.product-list {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 10px;
  margin-top: 20px;
}

#open-modal-button {
  background-color: {{ section.settings.open_modal_button_bg_color }};
  color: {{ section.settings.open_modal_button_text_color }};
  border: none;
  padding: {{ section.settings.open_modal_button_padding }};
  border-radius: {{ section.settings.open_modal_button_border_radius }};
  cursor: pointer;
  margin-top: 20px;
  font-size: {{ section.settings.open_modal_button_font_size }};
}

#open-modal-button:hover {
  background-color: {{ section.settings.open_modal_button_hover_bg_color }};
}

.remove-product {
  position: absolute;
  top: 5px;
  right: 5px;
  background: {{ section.settings.remove_button_bg_color }};
  color: {{ section.settings.remove_button_text_color }};
  border: none;
  border-radius: 50%;
  width: {{ section.settings.remove_button_size }};
  height: {{ section.settings.remove_button_size }};
  cursor: pointer;
  font-size: {{ section.settings.remove_button_font_size }};
  display: flex;
  align-items: center;
  justify-content: center;
}

.remove-product:hover {
  background: {{ section.settings.remove_button_hover_bg_color }};
}

.comparison-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
}

.comparison-table th, .comparison-table td {
  border: 1px solid #ddd;
  padding: 8px;
  text-align: left;
}

.comparison-table th {
  background-color: #f2f2f2;
}

.comparison-table tr:nth-child(even) {
  background-color: #f9f9f9;
}

/* Search and Pagination Styles */
.search-container {
  margin-bottom: 20px;
  position: relative;
}

#product-search, #change-product-search {
  width: 100%;
  padding: {{ section.settings.search_padding }};
  border: 1px solid {{ section.settings.search_border_color }};
  border-radius: {{ section.settings.search_border_radius }};
  font-size: {{ section.settings.search_font_size }};
  background-color: {{ section.settings.search_bg_color }};
  color: {{ section.settings.search_text_color }};
}

.search-icon {
  position: absolute;
  right: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: {{ section.settings.search_icon_color }};
}

.loading {
  text-align: center;
  padding: 20px;
  color: #777;
}

.pagination-info {
  text-align: center;
  margin: 15px 0;
  color: #666;
  font-size: 14px;
}

.load-more-container {
  text-align: center;
  margin-top: 20px;
}
.custom_product-comparison_flex{
  display: flex;
}

#load-more-button, #change-load-more-button {
  background-color: #ff580d;
  color: #ffffff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
  min-width: 200px;
  height: 40px;
  margin: auto;
}

#load-more-button:disabled, #change-load-more-button:disabled {
  cursor: not-allowed;
}

.metafield-value {
  margin-top: 5px;
  font-size: {{ section.settings.metafield_value_font_size }};
  color: {{ section.settings.metafield_value_color }};
}

.metafield-label {
  font-weight: bold;
  margin-top: 10px;
  font-size: {{ section.settings.metafield_label_font_size }};
  color: {{ section.settings.metafield_label_color }};
}

.no-products {
  text-align: center;
  padding: 20px;
  color: #777;
}

/* Modal heading styling */
#modal-heading {
  text-align: {{ section.settings.heading_alignment }};
  color: {{ section.settings.modal_heading_color }};
  font-size: {{ section.settings.modal_heading_font_size }};
  margin-bottom: {{ section.settings.modal_heading_margin_bottom }};
}

.change-product-button {
  background-color: #ffc107;
  color: #212529;
  border: none;
  padding: 8px 16px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  margin-top: 10px;
  width: 100%;
}

.change-product-button:hover {
  background-color: #e0a800;
}

.change-modal-heading {
  text-align: center;
  margin-bottom: 20px;
  color: #333;
}

.product-actions {
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 10px;
  width: 100%;
}
.product-table-view .porduct-empty-name {
  min-height: 280px;
}

/* New Design Styles Based on Image */
.product-card {
  border: 1px solid #e0e0e0;
  padding: 20px;
  background: white;
  position: relative;
  display: flex;
  flex-direction: column;
}

.product_compare--card {
  border: 1px solid #c3c3c3;
  padding: 15px;
  border-radius: 10px;
  position: relative;
  min-height: 280px;
}
.product_compare--card.current {
  border-color: #4CAF50;
  border-width: 2px;
}

.product_compare--card_badge {
  position: absolute;
  top: -10px;
  right: -10px;
  background: #4CAF50;
  color: white;
  padding: 4px 8px;
  border-radius: 50px;
  font-size: 11px;
  font-weight: bold;
}
.product_compare--card_image {
  overflow: hidden;
}
.product_compare--card-image {
  width: 60%;
  object-fit: contain;
  display: block;
  margin: auto;
  border-radius: 5px;
  transition: 0.7s ease;
}
.product_compare--card-image:hover {
  transform: scale(1.1);
}
.product-code {
  color: #666;
  font-size: 12px;
  margin-bottom: 4px;
}

.product-compare_card--title {
  font-size: 16px;
  font-weight: bold;
  margin-bottom: 8px;
  color: #333;
}

.product-model {
  color: #666;
  font-size: 14px;
  margin-bottom: 16px;
}

.product-specs {
  margin: 16px 0;
  text-align: left;
}

.spec-row {
  display: flex;
  justify-content: space-between;
  padding: 8px 0;
  min-height: 40px;
  border-bottom: 1px solid #f0f0f0;
}

.spec-label {
  font-weight: bold;
  color: #333;
}

.spec-value {
  color: #666;
}

.product-actions-new {
  margin-top: auto;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.btn-view {
  background: {{ section.settings.button_bg_color }};
  color: white;
  border: none;
  padding: 10px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.btn-change {
  background: {{ section.settings.change_btn_bg }};
  color: {{ section.settings.change_btn_color }};
  border: none;
  padding: 10px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
}

.btn-view:hover {
  background: {{ section.settings.button_hover_bg_color }};
}

.btn-change:hover {
  background: {{ section.settings.change_btn_hover }};
}

.comparison-header {
  text-align: center;
  margin-bottom: 30px;
}

.comparison-title {
  font-size: 24px;
  font-weight: bold;
  color: #333;
  margin-bottom: 8px;
}

.comparison-subtitle {
  color: #666;
  font-size: 16px;
}

.remove-product_compare--card {
  position: absolute;
  top: -7px;
  right: -6px;
  background: {{ section.settings.remove_btn_bg }};
  color: white;
  border: none;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 25px;
}

.remove-product_compare--card:hover {
  background:  {{ section.settings.remove_btn_hover }};
}

/* NEW: Responsive Styles - Added to existing styles */
@media (max-width: 1024px) {
  {% comment %} .custom_product-comparison_flex {
    flex-direction: column;
  }
  
  .product-table-view {
    display: none;
  } {% endcomment %}
  
  .comparison-row {
    overflow-x: auto;
    {% comment %} padding-bottom: 15px; {% endcomment %}
    scrollbar-width: thin;
    scrollbar-color: #ddd transparent;
  }
  
  .comparison-row::-webkit-scrollbar {
    height: 6px;
  }
  
  .comparison-row::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }
  
  .comparison-row::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 10px;
  }
  
  .comparison-row {
    display: flex;
    flex-wrap: nowrap;
    gap: 15px;
  }
  
  .product-card {
    min-width: 280px;
    flex-shrink: 0;
  }
}

@media (max-width: 768px) {
  .product-comparison {
    padding: 20px 0;
  }
  
  .comparison-header {
    margin-bottom: 20px;
  }
  
  .comparison-title {
    font-size: 20px;
  }
  
  .comparison-subtitle {
    font-size: 14px;
  }
  
  .product_compare--card {
    min-height: 250px;
    padding: 12px;
  }
  
  .product-compare_card--title {
    font-size: 14px;
  }
  
  .product_compare--card-image {
    width: 70%;
  }
  
  .modal-content {
    margin: 10% auto;
    width: 95%;
    padding: 15px;
  }
  
  .product-list {
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 8px;
  }
  
  .product_compare--popup_title {
    font-size: 14px;
  }
  
  #open-modal-button {
    width: 100%;
    margin-top: 15px;
  }
}

@media (max-width: 480px) {
  .product-table-view .porduct-empty-name{
    min-height: 300px;
  }
  .product-card {
    min-width: 175px;
    padding: 8px;
  }
  
  .product_compare--card {
    min-height: 230px;
  }
  
  .product_compare--card-image {
    width: 80%;
  }
  
  .product-actions-new {
    gap: 6px;
  }
  
  .btn-view, .btn-change {
    padding: 8px;
    font-size: 13px;
  }
  
  .spec-row {
    padding: 6px 0;
    min-height: 35px;
    font-size: 13px;
  }
  
  .product-list {
    grid-template-columns: 1fr 1fr;
  }
  
  .product_compare--popup {
    padding: 8px;
  }
  
  .add-to-comparison {
    height: 35px;
    font-size: 14px;
  }
}

/* Enhanced mobile interaction */
.comparison-row {
  -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
}

/* Visual indicator for scrollable content on mobile */
@media (max-width: 1024px) {
  .comparison-row::after {
    content: '';
    position: absolute;
    right: 0;
    top: 0;
    bottom: 0;
    width: 30px;
    background: linear-gradient(to right, transparent, rgba(0,0,0,0.1));
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.3s;
  }
  
  .comparison-row.scrollable::after {
    opacity: 1;
  }
}
</style>

<section class="product-comparison">
  <div class="container">
    <div class="comparison-header">
      <h1 class="comparison-title">{{ section.settings.heading }}</h1>
      <p class="comparison-subtitle">{{ section.settings.subheading }}</p>
    </div>
    <div class="custom_product-comparison_flex">
      <div class="product-table-view product-card">
        <div class="porduct-empty-name"> Product</div>
        <div class="metafield-lables product-specs">
          {% for block in section.blocks %}
            {% if block.settings.label %}
              <span class="spec-row">{{ block.settings.label }}</span>
            {% endif %}
          {% endfor %}
        </div>
      </div>
      <div class="comparison-row" id="comparison-container">
        <!-- Current product will be added here by JavaScript -->
      </div>
    </div>
    <button id="open-modal-button">+ Add Product to Compare</button>

    <!-- Modal Popup for Product Selection -->
    <div id="product-selection-modal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 id="modal-heading">Select Products for Comparison</h2>
        <div class="search-container">
          <input type="text" id="product-search" placeholder="Search products by name...">
          <span class="search-icon">üîç</span>
        </div>
        
        <div class="product-list" id="product-selection-list">
          <!-- Products will be loaded here by JavaScript -->
        </div>
        <div class="pagination-info" id="pagination-info"></div>
        <div class="load-more-container">
          <button id="load-more-button">Load More Products</button>
        </div>
      </div>
    </div>

    <div id="product-change-modal" class="modal change-modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2 class="change-modal-heading">Select a Replacement Product</h2>
        <div class="search-container">
          <input type="text" id="change-product-search" placeholder="Search products by name...">
          <span class="search-icon">üîç</span>
        </div>
        <div class="product-list" id="product-change-list">
          <!-- Products will be loaded here by JavaScript -->
        </div>
        <div class="pagination-info" id="change-pagination-info"></div>
        <div class="load-more-container">
          <button id="change-load-more-button">Load More Products</button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Preload products data with metafields using Liquid -->
<script type="application/json" id="AllProductsData">
{
  "products": [
    {%- comment -%} Get products from selected collection or all products {%- endcomment -%}
    {%- assign selected_collection = section.settings.collection_handle -%}
    
    {%- if selected_collection != blank -%}
      {%- assign product_collection = collections[selected_collection] -%}
      {%- assign products_to_show = product_collection.products -%}
      {%- comment -%} Products from selected collection {%- endcomment -%}
      {%- for product in products_to_show -%}
        {
          "id": {{ product.id | json }},
          "title": {{ product.title | json }},
          "handle": {{ product.handle | json }},
          "price": {{ product.price | money | json }},
          "url": {{ product.url | json }},
          "vendor": {{ product.vendor | json }},
          "type": {{ product.type | json }},
          "variants": {{ product.variants | json }},
          "featured_image": {
            "src": {{ product.featured_image | img_url: 'medium' | json }}
          },
          "images": {{ product.images | json }},
          "metafields": {
           {%- for block in section.blocks -%}
              {%- if block.type == "metafield" -%}
                {%- assign namespace = block.settings.namespace -%}
                {%- assign key = block.settings.key -%}
                {%- assign metafield_raw = product.metafields[namespace][key] | default: '' -%}
                {% assign meta_type = product.metafields[namespace][key].type %}
                {%- assign display_value = metafield_raw | escape -%}
                {% if meta_type == 'volume' %}
                  {%- assign after_value = metafield_raw | split: '"value":' | last | strip -%}
                  {%- assign value_part = after_value | split: ',' | first | strip | remove: '"' | remove: ' ' -%}

                  {%- assign after_unit = metafield_raw | split: '"unit":' | last | strip -%}
                  {%- assign unit_part = after_unit | split: '}' | first | strip | remove: '"' | remove: ' ' -%}

                  {%- assign display_value = value_part | append: ' ' | append: unit_part -%}
                {% endif %}
                "{{ namespace }}.{{ key }}": "{{ display_value }}"{% unless forloop.last %},{% endunless %}
              {%- endif -%}
            {%- endfor -%}
          }
        }{% unless forloop.last %},{% endunless %}
      {%- endfor -%}
    {%- else -%}
      {%- comment -%} All products (fallback) {%- endcomment -%}
      {%- paginate collections.all.products by 1000 -%}
        {%- for product in collections.all.products -%}
          {
            "id": {{ product.id | json }},
            "title": {{ product.title | json }},
            "handle": {{ product.handle | json }},
            "price": {{ product.price | money | json }},
            "url": {{ product.url | json }},
            "vendor": {{ product.vendor | json }},
            "type": {{ product.type | json }},
            "variants": {{ product.variants | json }},
            "featured_image": {
              "src": {{ product.featured_image | img_url: 'medium' | json }}
            },
            "images": {{ product.images | json }},
            "metafields": {
             {%- for block in section.blocks -%}
                {%- if block.type == "metafield" -%}
                  {%- assign namespace = block.settings.namespace -%}
                  {%- assign key = block.settings.key -%}
                  {%- assign metafield_raw = product.metafields[namespace][key] | default: '' -%}
                  {% assign meta_type = product.metafields[namespace][key].type %}
                  {%- assign display_value = metafield_raw | escape -%}
                  {% if meta_type == 'volume' %}
                    {%- assign after_value = metafield_raw | split: '"value":' | last | strip -%}
                    {%- assign value_part = after_value | split: ',' | first | strip | remove: '"' | remove: ' ' -%}

                    {%- assign after_unit = metafield_raw | split: '"unit":' | last | strip -%}
                    {%- assign unit_part = after_unit | split: '}' | first | strip | remove: '"' | remove: ' ' -%}

                    {%- assign display_value = value_part | append: ' ' | append: unit_part -%}
                  {% endif %}
                  "{{ namespace }}.{{ key }}": "{{ display_value }}"{% unless forloop.last %},{% endunless %}
                {%- endif -%}
              {%- endfor -%}
            }
          }{% unless forloop.last %},{% endunless %}
        {%- endfor -%}
      {%- endpaginate -%}
    {%- endif -%}
  ]
}
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {
  const currentProduct =  {{ product.id | json }};
  const recommendedProducts = [];
  // Get current product data with proper metafield handling
  recommendedProducts.push({
    tag: "Current",
    id: {{ product.id | json }},
    title: {{ product.title | json }},
    price: {{ product.price | money | json }},
    url: {{ product.url | json }},
    featured_image: {
      src: {{ product.featured_image | img_url: 'medium' | json }}
    },
    vendor: {{ product.vendor | json }},
    type: {{ product.type | json }},
    variants: {{ product.variants | json }},
    handle: {{ product.handle | json }},
    // For current product, use Liquid to get metafields
    metafields: {
      {%- for block in section.blocks -%}
        {%- if block.type == "metafield" -%}
          {%- assign namespace = block.settings.namespace -%}
          {%- assign key = block.settings.key -%}
          {%- assign metafield_raw = product.metafields[namespace][key] | default: '' -%}
          {% assign meta_type = product.metafields[namespace][key].type %}
          {%- assign display_value = metafield_raw | escape -%}
          {% if meta_type == 'volume' %}
            {%- assign after_value = metafield_raw | split: '"value":' | last | strip -%}
            {%- assign value_part = after_value | split: ',' | first | strip | remove: '"' | remove: ' ' -%}

            {%- assign after_unit = metafield_raw | split: '"unit":' | last | strip -%}
            {%- assign unit_part = after_unit | split: '}' | first | strip | remove: '"' | remove: ' ' -%}

            {%- assign display_value = value_part | append: ' ' | append: unit_part -%}
          {% endif %}
          "{{ namespace }}.{{ key }}": "{{ display_value }}"{% unless forloop.last %},{% endunless %}
        {%- endif -%}
      {%- endfor -%}
    }
  });

{% assign current_product_handle = product.handle %}
{% assign current_collection = product.collections.first.handle %}
{% assign source_products = recommendations.products | size  %}
{% if source_products > 0 %}
  {% assign product_list = recommendations.products %}
{% else %}
  {% assign product_list = collections[current_collection].products %}
{% endif %}
{% assign count = 0 %}
{% for item in product_list %}
  {% if item.handle != current_product_handle %}
    {% if count < 4 %}
      recommendedProducts.push({
        id: {{ item.id | json }},
        title: {{ item.title | json }},
        price: {{ item.price | money | json }},
        url: {{ item.url | json }},
        featured_image: {
          src: {{ item.featured_image | img_url: 'medium' | json }}
        },
        vendor: {{ item.vendor | json }},
        type: {{ item.type | json }},
        variants: {{ item.variants | json }},
        handle: {{ item.handle | json }},
        metafields: {
          {% assign metafield_index = 0 %}
          {% for block in section.blocks %}
            {% if block.type == "metafield" %}
              {% assign namespace = block.settings.namespace %}
              {% assign key = block.settings.key %}
              {% assign raw_metafield = item.metafields[namespace][key] %}
              {% assign meta_type = raw_metafield.type %}
              {% assign display_value = raw_metafield | escape %}

              {% if meta_type == "volume" %}
                {% assign after_value = raw_metafield | split: '"value":' | last | strip %}
                {% assign value_part = after_value | split: ',' | first | strip | remove: '"' | remove: ' ' %}
                {% assign after_unit = raw_metafield | split: '"unit":' | last | strip %}
                {% assign unit_part = after_unit | split: '}' | first | strip | remove: '"' | remove: ' ' %}
                {% assign display_value = value_part | append: ' ' | append: unit_part %}
              {% endif %}
              "{{ namespace }}.{{ key }}": "{{ display_value }}"{% assign metafield_index = metafield_index | plus: 1 %}{% if metafield_index < section.blocks.size %},{% endif %}
            {% endif %}
          {% endfor %}
        }
      });
      {% assign count = count | plus: 1 %}
    {% endif %}
  {% endif %}
{% endfor %}

  initializeComparison(recommendedProducts);
  
  // NEW: Mobile scroll detection
  function checkScrollable() {
    const comparisonRow = document.querySelector('.comparison-row');
    if (comparisonRow) {
      const isScrollable = comparisonRow.scrollWidth > comparisonRow.clientWidth;
      if (isScrollable) {
        comparisonRow.classList.add('scrollable');
      } else {
        comparisonRow.classList.remove('scrollable');
      }
    }
  }
  
  // Check on load and resize
  window.addEventListener('load', checkScrollable);
  window.addEventListener('resize', checkScrollable);
  
  // Get section settings
  const sectionSettings = {
    maxProducts: {{ section.settings.max_products | default: 4 }},
    modalBgColor: {{ section.settings.modal_bg_color | default: '#fefefe' | json }},
    modalTextColor: {{ section.settings.modal_text_color | default: '#333333' | json }},
    headingAlignment: {{ section.settings.heading_alignment | default: 'left' | json }},
    collectionHandle: {{ section.settings.collection_handle | json }} || ''
  };
  
  // Apply modal styling
  applyModalStyling(sectionSettings);
  
  // Pagination variables
  let currentPage = 1;
  let allProducts = [];
  let filteredProducts = [];
  let searchQuery = '';
  const productsPerPage = 20;
  let changeCurrentPage = 1;
  let changeSearchQuery = '';
  let productToReplaceId = null;
  let allPreloadedProducts = [];
  try {
    const preloadedData = JSON.parse(document.getElementById('AllProductsData').textContent);
    allPreloadedProducts = preloadedData.products || [];
    console.log('ALL Preloaded products with metafields:', allPreloadedProducts.length, 'products');
    allProducts = allPreloadedProducts.filter(product => product.id !== currentProduct.id);
    console.log('Filtered products for comparison:', allProducts.length, 'products');
    
  } catch (error) {
    console.error('Error parsing preloaded products data:', error);
  }
  document.getElementById("comparison-container").addEventListener("click", function(e) {
    if (e.target.classList.contains('btn-change')) {
      const productCard = e.target.closest('.product-card');
      if (productCard && !productCard.classList.contains('current')) {
        const productId = productCard.getAttribute('data-product-id');
        openChangeModal(productId);
      }
    }
    if (e.target.classList.contains('remove-product_compare--card')) {
      const productCard = e.target.closest('.product-card');
      if (productCard && !productCard.classList.contains('current')) {
        const productId = productCard.getAttribute('data-product-id');
        removeProductFromComparison(productId);
      }
    }
    if (e.target.classList.contains('btn-view')) {
      const productCard = e.target.closest('.product-card');
      if (productCard) {
        const productId = productCard.getAttribute('data-product-id');
        const product = getAllProducts().find(p => p.id == productId);
        if (product && product.url) {
          window.location.href = product.url;
        }
      }
    }
  });

  // Open the modal
  document.getElementById("open-modal-button").addEventListener("click", function() {
    currentPage = 1;
    searchQuery = '';
    document.getElementById("product-search").value = '';
    filterAndDisplayProducts();
    document.getElementById("product-selection-modal").style.display = "block";
  });
  document.querySelectorAll(".close").forEach(closeBtn => {
    closeBtn.addEventListener("click", function() {
      document.getElementById("product-selection-modal").style.display = "none";
      document.getElementById("product-change-modal").style.display = "none";
    });
  });
  window.addEventListener("click", function (event) {
    const selectionModal = document.getElementById("product-selection-modal");
    const changeModal = document.getElementById("product-change-modal");
    
    if (event.target === selectionModal) {
      selectionModal.style.display = "none";
    }
    if (event.target === changeModal) {
      changeModal.style.display = "none";
    }
  });
  document.getElementById("product-search").addEventListener('input', function(e) {
    searchQuery = e.target.value.toLowerCase();
    currentPage = 1;
    filterAndDisplayProducts();
  });
  document.getElementById("change-product-search").addEventListener('input', function(e) {
    changeSearchQuery = e.target.value.toLowerCase();
    changeCurrentPage = 1;
    filterAndDisplayChangeProducts();
  });
  document.getElementById("load-more-button").addEventListener('click', function() {
    currentPage++;
    filterAndDisplayProducts();
  });
  document.getElementById("change-load-more-button").addEventListener('click', function() {
    changeCurrentPage++;
    filterAndDisplayChangeProducts();
  });

  function applyModalStyling(settings) {
    const modalContent = document.querySelector('.modal-content');
    const modalHeading = document.getElementById('modal-heading');
    
    if (modalContent) {
      modalContent.style.backgroundColor = settings.modalBgColor;
      modalContent.style.color = settings.modalTextColor;
    }
    
    if (modalHeading) {
      modalHeading.style.textAlign = settings.headingAlignment;
    }
  }

  // SIMPLIFIED: No need for API calls - we have all data preloaded!
  function filterAndDisplayProducts() {
    const productList = document.getElementById("product-selection-list");
    const loadMoreButton = document.getElementById("load-more-button");
    const paginationInfo = document.getElementById("pagination-info");
    // Apply search filter
    if (searchQuery) {
      filteredProducts = allProducts.filter(product => 
        product.title && product.title.toLowerCase().includes(searchQuery)
      );
    } else {
      filteredProducts = [...allProducts];
    }
    
    console.log('Filtered products for display:', filteredProducts.length);
    
    // Display products with pagination
    displayProductsForSelection(filteredProducts);
    
    // Update pagination info
    const startIndex = (currentPage - 1) * productsPerPage;
    const endIndex = startIndex + productsPerPage;
    const totalPages = Math.ceil(filteredProducts.length / productsPerPage);
    
    paginationInfo.textContent = `Showing ${Math.min(endIndex, filteredProducts.length)} of ${filteredProducts.length} products`;
    
    // Show/hide load more button
    if (currentPage < totalPages) {
      loadMoreButton.style.display = 'block';
      loadMoreButton.disabled = false;
    } else {
      loadMoreButton.style.display = 'none';
    }
  }

  // Function to display products in the selection modal
  function displayProductsForSelection(products) {
    const productList = document.getElementById("product-selection-list");
    
    if (!products || products.length === 0) {
      productList.innerHTML = '<div class="no-products">No products found matching your search.</div>';
      return;
    }
    
    // Calculate pagination
    const startIndex = (currentPage - 1) * productsPerPage;
    const endIndex = startIndex + productsPerPage;
    const productsToShow = products.slice(startIndex, endIndex);
    
    // Always clear the list when displaying new products
    productList.innerHTML = '';
    
    // Get current comparison products
    const comparisonProducts = getComparisonProductIds();
    
    productsToShow.forEach(product => {
      const productOption = document.createElement('div');
      productOption.className = 'product-option';
      productOption.setAttribute('data-product-id', product.id);
      productOption.setAttribute('data-product-handle', product.handle);
      
      // Get the correct image URL
      let imageUrl = '/assets/no-image.jpg';
      let imageAlt = product.title || 'Product image';
      
      if (product.featured_image) {
        if (typeof product.featured_image === 'string') {
          imageUrl = product.featured_image;
        } else if (product.featured_image.src) {
          imageUrl = product.featured_image.src;
        }
      } else if (product.images && product.images.length > 0) {
        if (typeof product.images[0] === 'string') {
          imageUrl = product.images[0];
        } else if (product.images[0].src) {
          imageUrl = product.images[0].src;
        }
      }
      
      // Ensure we have a proper Shopify image URL
      if (!imageUrl.startsWith('http') && !imageUrl.startsWith('//')) {
        if (imageUrl.startsWith('/')) {
          imageUrl = `https://${window.location.hostname}${imageUrl}`;
        }
      }
      {% comment %} imageUrl = imageUrl.replace(/_(large|grande|medium|small)\./, '_small.'); {% endcomment %}
      const productTitle = product.title || 'Untitled Product';
      const productPrice = formatProductPrice(product);
      const productHandle = product.handle || '';
      const isInComparison = comparisonProducts.includes(product.id);
      const buttonText = isInComparison ? 'Added' : 'Add to Comparison';
      const buttonClass = isInComparison ? 'add-to-comparison added' : 'add-to-comparison';
      
      productOption.innerHTML = `
        <div class="product_compare--popup">
          <div class="product_compare--popup-box">
            <img src="${imageUrl}" alt="${imageAlt}" class="product_compare--popup_image" onerror="this.src='/assets/no-image.jpg'">
            <h3 class="product_compare--popup_title">${productTitle.length > 50 ? productTitle.substring(0, 50) + '...' : productTitle}</h3>
            <p class="product_compare--popup_price">${productPrice}</p>
          </div>
          <div class="product_added-to-compare_btn">
            <button data-product-id="${product.id}" data-product-handle="${productHandle}" class="${buttonClass}">${buttonText}</button>
          </div>
        </div>
      `;
      
      productList.appendChild(productOption);
    });
    productList.addEventListener('click', function(e) {
      if (e.target.classList.contains('add-to-comparison')) {
        const productId = e.target.getAttribute("data-product-id");
        const product = allProducts.find(p => p.id == productId);
        
        if (product) {
          if (e.target.classList.contains('added')) {
            // Remove from comparison
            removeProductFromComparison(productId);
            e.target.textContent = 'Add to Comparison';
            e.target.classList.remove('added');
          } else {
            // Add to comparison
            console.log('Adding product to comparison:', product.title);
            console.log('Product metafields:', product.metafields);
            addProductToComparison(product);
            e.target.textContent = 'Added';
            e.target.classList.add('added');
            // NEW: Check scrollable after adding product
            setTimeout(checkScrollable, 100);
          }
        }
      }
    });
  }
  function initializeComparison(products) {
    const comparisonContainer = document.getElementById("comparison-container");
    comparisonContainer.innerHTML = "";

    products.forEach(product => {
      const specsHTML = generateSpecsHTML(product);
      const productTitle = product.title || "";
      const imageUrl = product.featured_image?.src || "/assets/no-image.jpg";

      let productCardHTML = '';

      if (product.tag) {
        productCardHTML = `
          <div class="product-card" data-product-id="${product.id}">
            <div class="product_compare--card current">
              <div class="product_compare--card_badge">${product.tag}</div>
              <div class="product_compare--card_image">
                <img src="${imageUrl}" alt="${productTitle}" class="product_compare--card-image" onerror="this.src='/assets/no-image.jpg'">
              </div>
              <div class="product-compare_card--title">
                ${productTitle.length > 30 ? productTitle.substring(0, 30) + '...' : productTitle}
              </div>
              <p class="product-compare_card--price">${product.price}</p>
            </div>
            <div class="product-specs">
              ${specsHTML}
            </div>
          </div>
        `;
      } else {
        // Template when product.tag does NOT exist
        productCardHTML = `
          <div class="product-card" data-product-id="${product.id}">
            <div class="product_compare--card">
              <button class="remove-product_compare--card">√ó</button>
              <div class="product_compare--card_image">
                <img src="${imageUrl}" alt="${productTitle}" class="product_compare--card-image" onerror="this.src='/assets/no-image.jpg'">
              </div>
              <div class="product-compare_card--title">
                ${productTitle.length > 30 ? productTitle.substring(0, 30) + '...' : productTitle}
              </div>
              <p class="product-compare_card--price">${product.price}</p>
            </div>
            <div class="product-specs">
              ${specsHTML}
            </div>
            <div class="product-actions-new">
              <button class="btn-view">View Product</button>
              <button class="btn-change">Change</button>
            </div>
          </div>
        `;
      }

      comparisonContainer.innerHTML += productCardHTML;
    });
    
    // NEW: Check if scrollable after initialization
    setTimeout(checkScrollable, 100);
  }
  function addProductToComparison(product) {
    const comparisonContainer = document.getElementById("comparison-container");
    const existingProduct = comparisonContainer.querySelector(`[data-product-id="${product.id}"]`);
    if (existingProduct) {
      alert('This product is already in the comparison.');
      return;
    }
    const comparisonProducts = comparisonContainer.querySelectorAll('.product-card');
    if (comparisonProducts.length >= sectionSettings.maxProducts) {
      alert(`Maximum number of comparison products (${sectionSettings.maxProducts}) reached. Please remove one before adding another.`);
      return;
    }
    let imageUrl = '/assets/no-image.jpg';
    if (product.featured_image) {
      if (typeof product.featured_image === 'string') {
        imageUrl = product.featured_image;
      } else if (product.featured_image.src) {
        imageUrl = product.featured_image.src;
      }
    } else if (product.images && product.images.length > 0) {
      if (typeof product.images[0] === 'string') {
        imageUrl = product.images[0];
      } else if (product.images[0].src) {
        imageUrl = product.images[0].src;
      }
    }
    
    const productTitle = product.title || 'Untitled Product';
    const productHandle = product.handle || '';
    const productCode = getMetafieldValue(product, 'custom', 'product_code') || 'HP' + (1000 + comparisonProducts.length);
    const productModel = getMetafieldValue(product, 'custom', 'product_model') || 'E' + (14000 + comparisonProducts.length);
    const specsHTML = generateSpecsHTML(product);
    
    const productHTML = `
      <div class="product-card" data-product-id="${product.id}">
        <div class="product_compare--card">
          <button class="remove-product_compare--card">√ó</button>
          <div class="product_compare--card_image">
            <img src="${imageUrl}" alt="${productTitle}" class="product_compare--card-image" onerror="this.src='/assets/no-image.jpg'">
          </div>
          <div class="product-compare_card--title">${productTitle.length > 30 ? product.title.substring(0, 30) + '...' : productTitle}</div>
          <p class="product-compare_card--price">${product.price}</p>
        </div>
        <div class="product-specs">
          ${specsHTML}
        </div>
        <div class="product-actions-new">
          <button class="btn-view">View Product</button>
          <button class="btn-change">Change</button>
        </div>
      </div>
    `;
    
    comparisonContainer.innerHTML += productHTML;
    updateAddToComparisonButtons();
    if (comparisonContainer.querySelectorAll('.product-card').length >= sectionSettings.maxProducts) {
      document.getElementById("product-selection-modal").style.display = "none";
    }
    
    // NEW: Check scrollable after adding
    setTimeout(checkScrollable, 100);
  }
  function removeProductFromComparison(productId) {
    const productElement = document.querySelector(`[data-product-id="${productId}"]`);
    if (productElement && !productElement.classList.contains('current')) {
      productElement.remove();
      updateAddToComparisonButtons();
      // NEW: Check scrollable after removal
      setTimeout(checkScrollable, 100);
    }
  }
  function getComparisonProductIds() {
    const comparisonContainer = document.getElementById("comparison-container");
    const productItems = comparisonContainer.querySelectorAll('.product-card');
    const productIds = [];
    
    productItems.forEach(item => {
      productIds.push(parseInt(item.getAttribute('data-product-id')));
    });
    
    return productIds;
  }
  function updateAddToComparisonButtons() {
    const comparisonProductIds = getComparisonProductIds();
    
    document.querySelectorAll('.add-to-comparison').forEach(button => {
      const productId = parseInt(button.getAttribute('data-product-id'));
      
      if (comparisonProductIds.includes(productId)) {
        button.textContent = 'Added';
        button.classList.add('added');
      } else {
        button.textContent = 'Add to Comparison';
        button.classList.remove('added');
      }
    });
  }
  function openChangeModal(productId) {
    productToReplaceId = productId;
    changeCurrentPage = 1;
    changeSearchQuery = '';
    document.getElementById("change-product-search").value = '';
    
    filterAndDisplayChangeProducts();
    document.getElementById("product-change-modal").style.display = "block";
  }
  function filterAndDisplayChangeProducts() {
    const productList = document.getElementById("product-change-list");
    const loadMoreButton = document.getElementById("change-load-more-button");
    const paginationInfo = document.getElementById("change-pagination-info");
    let changeFilteredProducts;
    if (changeSearchQuery) {
      changeFilteredProducts = allProducts.filter(product => 
        product.title && product.title.toLowerCase().includes(changeSearchQuery)
      );
    } else {
      changeFilteredProducts = [...allProducts];
    }
    const comparisonProductIds = getComparisonProductIds();
    changeFilteredProducts = changeFilteredProducts.filter(product => 
      !comparisonProductIds.includes(product.id) || product.id === productToReplaceId
    );
    
    console.log('Filtered products for change:', changeFilteredProducts.length);
    displayProductsForChange(changeFilteredProducts);
    const startIndex = (changeCurrentPage - 1) * productsPerPage;
    const endIndex = startIndex + productsPerPage;
    const totalPages = Math.ceil(changeFilteredProducts.length / productsPerPage);
    
    paginationInfo.textContent = `Showing ${Math.min(endIndex, changeFilteredProducts.length)} of ${changeFilteredProducts.length} products`;
    if (changeCurrentPage < totalPages) {
      loadMoreButton.style.display = 'block';
      loadMoreButton.disabled = false;
    } else {
      loadMoreButton.style.display = 'none';
    }
  }
  function displayProductsForChange(products) {
    const productList = document.getElementById("product-change-list");
    if (!products || products.length === 0) {
      productList.innerHTML = '<div class="no-products">No products found matching your search.</div>';
      return;
    }
    const startIndex = (changeCurrentPage - 1) * productsPerPage;
    const endIndex = startIndex + productsPerPage;
    const productsToShow = products.slice(startIndex, endIndex);
    if (changeCurrentPage === 1) {
      productList.innerHTML = '';
    }
    
    productsToShow.forEach(product => {
      if (document.querySelector(`#product-change-list [data-product-id="${product.id}"]`)) {
        return;
      }
      const productOption = document.createElement('div');
      productOption.className = 'product-option';
      productOption.setAttribute('data-product-id', product.id);
      productOption.setAttribute('data-product-handle', product.handle);
      let imageUrl = '/assets/no-image.jpg';
      let imageAlt = product.title || 'Product image';
      
      if (product.featured_image) {
        if (typeof product.featured_image === 'string') {
          imageUrl = product.featured_image;
        } else if (product.featured_image.src) {
          imageUrl = product.featured_image.src;
        }
      } else if (product.images && product.images.length > 0) {
        if (typeof product.images[0] === 'string') {
          imageUrl = product.images[0];
        } else if (product.images[0].src) {
          imageUrl = product.images[0].src;
        }
      }
      if (!imageUrl.startsWith('http') && !imageUrl.startsWith('//')) {
        if (imageUrl.startsWith('/')) {
          imageUrl = `https://${window.location.hostname}${imageUrl}`;
        }
      }
      {% comment %} imageUrl = imageUrl.replace(/_(large|grande|medium|small)\./, '_small.'); {% endcomment %}
      const productTitle = product.title || 'Untitled Product';
      const productPrice = formatProductPrice(product);
      
      productOption.innerHTML = `
        <div class="product_compare--popup product_compare--popup_change">
          <div class="product_compare--popup-box">
            <img src="${imageUrl}" alt="${imageAlt}" class="product_compare--popup_image" onerror="this.src='/assets/no-image.jpg'">
            <h3 class="product_compare--popup_title">${productTitle.length > 50 ? productTitle.substring(0, 50) + '...' : productTitle}</h3>
            <p class="product_compare--popup_price">${productPrice}</p>
          </div>
        </div>
      `;
      
      productList.appendChild(productOption);
      productOption.addEventListener('click', function() {
        document.querySelectorAll('#product-change-list .product-option').forEach(option => {
          option.classList.remove('selected');
        });
        this.classList.add('selected');
        replaceProductInComparison(productToReplaceId, product);
        setTimeout(() => {
          document.getElementById("product-change-modal").style.display = "none";
        }, 500);
      });
    });
  }

  function replaceProductInComparison(oldProductId, newProduct) {
    removeProductFromComparison(oldProductId);
    addProductToComparison(newProduct);
    updateAddToComparisonButtons();
  }

  // Function to get metafield value
  function getMetafieldValue(product, namespace, key) {
    if (!product.metafields) return null;
    const metafieldKey = `${namespace}.${key}`;
    if (product.metafields[metafieldKey] !== undefined && product.metafields[metafieldKey] !== null && product.metafields[metafieldKey] !== '') {
      return product.metafields[metafieldKey];
    }
    else if (product.metafields[namespace] && product.metafields[namespace][key] !== undefined && product.metafields[namespace][key] !== null && product.metafields[namespace][key] !== '') {
      return product.metafields[namespace][key];
    }
    else if (product.metafields[key] !== undefined && product.metafields[key] !== null && product.metafields[key] !== '') {
      return product.metafields[key];
    }
    
    return null;
  }
  function generateSpecsHTML(product) {
    let specsHTML = '';
    const metafieldBlocks = [];
    {% if section.blocks %}
      {% for block in section.blocks %}
        {% if block.type == "metafield" %}
          metafieldBlocks.push({
            settings: {
              namespace: {{ block.settings.namespace | json }},
              key: {{ block.settings.key | json }},
              label: {{ block.settings.label | json }}
            }
          });
        {% endif %}
      {% endfor %}
    {% endif %}
    
    console.log('Metafield blocks to display:', metafieldBlocks);
    
    metafieldBlocks.forEach(block => {
      const namespace = block.settings.namespace;
      const key = block.settings.key;
      const label = block.settings.label || key;
      
      if (namespace && key) {
        const metafieldValue = getMetafieldValue(product, namespace, key);
        console.log('metafieldValue', typeof metafieldValue);
        // If we found a metafield value, display it
        if (metafieldValue) {
          specsHTML += `
            <div class="spec-row">
              {% comment %} <span class="spec-label">${label}</span> {% endcomment %}
              <span class="spec-value">${metafieldValue}</span>
            </div>
          `;
        }else{
          specsHTML += `
            <div class="spec-row">
              <span class="spec-value"></span>
            </div>
          `;
        }
      }
    });
    if (!specsHTML) {
      specsHTML = ``;
    }
    return specsHTML;
  }
  function getAllProducts() {
    return [currentProduct, ...allProducts];
  }
  function formatProductPrice(product) {
    let price = null;
    if (product.price) {
      price = product.price;
    } else if (product.variants && product.variants.length > 0) {
      price = product.variants[0].price;
    }
    if (price) {
      if (typeof price === 'string' && (price.includes('$') || price.includes('‚Ç¨') || price.includes('¬£'))) {
        return price;
      }
      if (typeof price === 'number') {
        if (price > 1000) {
          return '$' + (price / 100).toFixed(2);
        } else {
          return '$' + price.toFixed(2);
        }
      }
      if (typeof price === 'string') {
        const numPrice = parseFloat(price);
        if (!isNaN(numPrice)) {
          if (numPrice > 1000) {
            return '¬£' + (numPrice / 100).toFixed(2);
          } else {
            return '¬£' + numPrice.toFixed(2);
          }
        }
      }
    }
    return 'Price unavailable';
  }
});
</script>

{% schema %}
{
  "name": "Custom Product Comparison",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Product Comparison"
    },
    {
      "type": "inline_richtext",
      "id": "subheading",
      "label": "Sub Heading",
      "default":"Compare features and specifications"
    },
    {
      "type": "header",
      "content": "Product Comparison"
    },
    {
      "type": "collection",
      "label": "Collection for Comparison",
      "id": "collection_handle",
      "info": "Select a collection to show products from. Leave empty to show all products."
    },
    {
      "type": "range",
      "id": "max_products",
      "min": 2,
      "max": 6,
      "step": 1,
      "label": "Maximum Products for Comparison",
      "default": 4
    },
    {
      "type": "select",
      "id": "comparison_alignment",
      "label": "Comparison Alignment",
      "options": [
        {
          "value": "flex-start",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "flex-end",
          "label": "Right"
        },
        {
          "value": "space-between",
          "label": "Space Between"
        }
      ],
      "default": "flex-start"
    },
    {
      "type": "header",
      "content": "Product Card Styling"
    },
    {
      "type": "color",
      "id": "product_bg_color",
      "label": "Product Background Color",
      "default": "transparent"
    },
    {
      "type": "color",
      "id": "product_border_color",
      "label": "Product Border Color",
      "default": "#ddd"
    },
    {
      "type": "text",
      "id": "product_border_radius",
      "label": "Product Border Radius",
      "default": "0px"
    },
    {
      "type": "text",
      "id": "product_padding",
      "label": "Product Padding",
      "default": "20px"
    },
    {
      "type": "text",
      "id": "product_min_width",
      "label": "Product Minimum Width",
      "default": "200px"
    },
    {
      "type": "text",
      "id": "product_max_width",
      "label": "Product Maximum Width",
      "default": "250px"
    },
    {
      "type": "text",
      "id": "product_hover_scale",
      "label": "Product Hover Scale",
      "default": "1.05"
    },
    {
      "type": "text",
      "id": "product_hover_shadow",
      "label": "Product Hover Shadow",
      "default": "10px"
    },
    {
      "type": "color",
      "id": "current_product_border_color",
      "label": "Current Product Border Color",
      "default": "#00FF00"
    },
    {
      "type": "color",
      "id": "current_label_bg_color",
      "label": "Current Label Background Color",
      "default": "#00FF00"
    },
    {
      "type": "color",
      "id": "current_label_text_color",
      "label": "Current Label Text Color",
      "default": "#FFF"
    },
    {
      "type": "text",
      "id": "current_label_border_radius",
      "label": "Current Label Border Radius",
      "default": "0px"
    },
    {
      "type": "header",
      "content": "Button Styling"
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Button Background Color",
      "default": "#4CAF50"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#FFF"
    },
    {
      "type": "color",
      "id": "button_hover_bg_color",
      "label": "Button Hover Background Color",
      "default": "#45a049"
    },
    {
      "type": "color",
      "id": "button_hover_text_color",
      "label": "Button Hover Text Color",
      "default": "#FFF"
    },
    {
      "type": "text",
      "id": "button_padding",
      "label": "Button Padding",
      "default": "10px 20px"
    },
    {
      "type": "text",
      "id": "button_border_radius",
      "label": "Button Border Radius",
      "default": "5px"
    },
    {
      "type": "text",
      "id": "button_font_size",
      "label": "Button Font Size",
      "default": "14px"
    },
    {
      "type": "text",
      "id": "button_border",
      "label": "Button Border",
      "default": "none"
    },
    {
      "type": "color",
      "id": "change_btn_color",
      "label": "Change Button Color",
      "default": "#fff"
    },
    {
      "type": "color",
      "id": "change_btn_bg",
      "label": "Change Button Bg Color",
      "default": "#dc3545"
    },
    {
      "type": "color",
      "id": "change_btn_hover",
      "label": "Change Button Hover Color",
      "default": "#dc3545"
    },
    {
      "type": "color",
      "id": "remove_btn_bg",
      "label": "Remove Button Bg Color",
      "default": "#dc3545"
    },
    {
      "type": "color",
      "id": "remove_btn_hover",
      "label": "Remove Button Hover Color",
      "default": "#dc3545"
    },
    {
      "type": "header",
      "content": "Modal Styling"
    },
    {
      "type": "color",
      "id": "modal_bg_color",
      "label": "Modal Background Color",
      "default": "#fefefe"
    },
    {
      "type": "color",
      "id": "modal_text_color",
      "label": "Modal Text Color",
      "default": "#333333"
    },
    {
      "type": "text",
      "id": "modal_overlay_opacity",
      "label": "Modal Overlay Opacity",
      "default": "0.5"
    },
    {
      "type": "color",
      "id": "close_button_color",
      "label": "Close Button Color",
      "default": "#aaa"
    },
    {
      "type": "color",
      "id": "close_button_hover_color",
      "label": "Close Button Hover Color",
      "default": "#000"
    },
    {
      "type": "header",
      "content": "Modal Heading"
    },
    {
      "type": "select",
      "id": "heading_alignment",
      "label": "Heading Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left"
    },
    {
      "type": "color",
      "id": "modal_heading_color",
      "label": "Modal Heading Color",
      "default": "#000"
    },
    {
      "type": "text",
      "id": "modal_heading_font_size",
      "label": "Modal Heading Font Size",
      "default": "24px"
    },
    {
      "type": "text",
      "id": "modal_heading_margin_bottom",
      "label": "Modal Heading Margin Bottom",
      "default": "20px"
    },
    {
      "type": "header",
      "content": "Modal Product Grid"
    },
    {
      "type": "header",
      "content": "Modal Buttons"
    },
    {
      "type": "color",
      "id": "modal_button_bg_color",
      "label": "Modal Button Background Color",
      "default": "#4CAF50"
    },
    {
      "type": "color",
      "id": "modal_button_text_color",
      "label": "Modal Button Text Color",
      "default": "#FFF"
    },
    {
      "type": "color",
      "id": "modal_button_hover_bg_color",
      "label": "Modal Button Hover Background Color",
      "default": "#45a049"
    },
    {
      "type": "text",
      "id": "modal_button_padding",
      "label": "Modal Button Padding",
      "default": "8px 16px"
    },
    {
      "type": "text",
      "id": "modal_button_border_radius",
      "label": "Modal Button Border Radius",
      "default": "4px"
    },
    {
      "type": "text",
      "id": "modal_button_font_size",
      "label": "Modal Button Font Size",
      "default": "14px"
    },
    {
      "type": "header",
      "content": "Open Modal Button"
    },
    {
      "type": "color",
      "id": "open_modal_button_bg_color",
      "label": "Open Modal Button Background Color",
      "default": "#007bff"
    },
    {
      "type": "color",
      "id": "open_modal_button_text_color",
      "label": "Open Modal Button Text Color",
      "default": "#FFF"
    },
    {
      "type": "color",
      "id": "open_modal_button_hover_bg_color",
      "label": "Open Modal Button Hover Background Color",
      "default": "#0056b3"
    },
    {
      "type": "text",
      "id": "open_modal_button_padding",
      "label": "Open Modal Button Padding",
      "default": "10px 20px"
    },
    {
      "type": "text",
      "id": "open_modal_button_border_radius",
      "label": "Open Modal Button Border Radius",
      "default": "4px"
    },
    {
      "type": "text",
      "id": "open_modal_button_font_size",
      "label": "Open Modal Button Font Size",
      "default": "16px"
    },
    {
      "type": "header",
      "content": "Remove Button"
    },
    {
      "type": "color",
      "id": "remove_button_bg_color",
      "label": "Remove Button Background Color",
      "default": "#ff4444"
    },
    {
      "type": "color",
      "id": "remove_button_text_color",
      "label": "Remove Button Text Color",
      "default": "#FFF"
    },
    {
      "type": "color",
      "id": "remove_button_hover_bg_color",
      "label": "Remove Button Hover Background Color",
      "default": "#cc0000"
    },
    {
      "type": "text",
      "id": "remove_button_size",
      "label": "Remove Button Size",
      "default": "24px"
    },
    {
      "type": "text",
      "id": "remove_button_font_size",
      "label": "Remove Button Font Size",
      "default": "14px"
    },
    {
      "type": "header",
      "content": "Search Styling"
    },
    {
      "type": "color",
      "id": "search_bg_color",
      "label": "Search Background Color",
      "default": "#FFF"
    },
    {
      "type": "color",
      "id": "search_text_color",
      "label": "Search Text Color",
      "default": "#000"
    },
    {
      "type": "color",
      "id": "search_border_color",
      "label": "Search Border Color",
      "default": "#ddd"
    },
    {
      "type": "text",
      "id": "search_border_radius",
      "label": "Search Border Radius",
      "default": "4px"
    },
    {
      "type": "text",
      "id": "search_padding",
      "label": "Search Padding",
      "default": "10px 40px 10px 15px"
    },
    {
      "type": "text",
      "id": "search_font_size",
      "label": "Search Font Size",
      "default": "16px"
    },
    {
      "type": "color",
      "id": "search_icon_color",
      "label": "Search Icon Color",
      "default": "#777"
    },
    {
      "type": "header",
      "content": "Product Images"
    },
    {
      "type": "header",
      "content": "Metafield Styling"
    },
    {
      "type": "color",
      "id": "metafield_label_color",
      "label": "Metafield Label Color",
      "default": "#000"
    },
    {
      "type": "text",
      "id": "metafield_label_font_size",
      "label": "Metafield Label Font Size",
      "default": "14px"
    },
    {
      "type": "color",
      "id": "metafield_value_color",
      "label": "Metafield Value Color",
      "default": "#555"
    },
    {
      "type": "text",
      "id": "metafield_value_font_size",
      "label": "Metafield Value Font Size",
      "default": "14px"
    }
  ],
  "blocks": [
    {
      "type": "metafield",
      "name": "Metafield",
      "settings": [
        {
          "type": "text",
          "id": "namespace",
          "label": "Metafield Namespace",
          "info": "The namespace of the metafield (e.g., 'custom')"
        },
        {
          "type": "text",
          "id": "key",
          "label": "Metafield Key",
          "info": "The key of the metafield (e.g., 'material')"
        },
        {
          "type": "text",
          "id": "label",
          "label": "Display Label",
          "info": "Optional: Custom label to display (defaults to the key)"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Custom Product Comparison",
      "category": "Custom"
    }
  ]
}
{% endschema %}